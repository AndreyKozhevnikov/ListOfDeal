<dx:DXWindow xmlns:dxg="http://schemas.devexpress.com/winfx/2008/xaml/grid" 
        xmlns:dx="http://schemas.devexpress.com/winfx/2008/xaml/core" 
        x:Class="ListOfDeal.MainWindow"
        xmlns:dxe="http://schemas.devexpress.com/winfx/2008/xaml/editors"
        xmlns:dxlc="http://schemas.devexpress.com/winfx/2008/xaml/layoutcontrol"
        xmlns:dxmvvm="http://schemas.devexpress.com/winfx/2008/xaml/mvvm"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
         xmlns:local="clr-namespace:ListOfDeal"
        Title="MainWindow" Height="700" Width="1200"
             WindowState="Maximized"
             SnapsToDevicePixels="True" UseLayoutRounding="True"
             >
    <Window.Resources>
        <dxmvvm:ObjectToBooleanConverter x:Key="objToBoolConverter"/>
    </Window.Resources>
    <Grid>
        <dx:DXTabControl>

            <dx:DXTabItem Header="Enter new project">
                <dxlc:LayoutGroup Orientation="Vertical">
                    <dxlc:LayoutGroup>
                        <dxlc:LayoutGroup Orientation="Vertical" x:Name="ProjectsGroup">
                            <dxmvvm:Interaction.Behaviors>
                                <dxmvvm:EventToCommand EventName="PreviewKeyDown" Command="{Binding PreviewKeyProjectsCommand}" PassEventArgsToCommand="True"/>
                            </dxmvvm:Interaction.Behaviors>
                            <dxlc:LayoutItem Label="Name:">
                                <dxe:TextEdit EditValue="{Binding CurrentProject.Name,UpdateSourceTrigger=PropertyChanged}"/>
                            </dxlc:LayoutItem>
                            <dxlc:LayoutItem Label="Type:">
                                <dxe:ComboBoxEdit ItemsSource="{Binding ProjectTypes}" ValueMember="Id" DisplayMember="Name" EditValue="{Binding CurrentProject.TypeId}">
                                    <dxe:ComboBoxEdit.Buttons>
                                        <dxe:ButtonInfo Content="+" Command="{Binding OpenNewInfoCommand}" CommandParameter="ProjectType"/>
                                    </dxe:ComboBoxEdit.Buttons>
                                </dxe:ComboBoxEdit>
                            </dxlc:LayoutItem>
                            <dxlc:LayoutItem Label="Status:">
                                <dxe:ComboBoxEdit ItemsSource="{Binding ProjectStatuses}" ValueMember="Id" DisplayMember="Name" EditValue="{Binding CurrentProject.StatusId}"/>
                            </dxlc:LayoutItem>
                            <dxlc:LayoutItem Label="Comment:">
                                <dxe:MemoEdit EditValue="{Binding CurrentProject.Comment}"/>
                            </dxlc:LayoutItem>
                            <dxlc:LayoutItem Label="DesiredResult:">
                                <dxe:TextEdit EditValue="{Binding CurrentProject.DesiredResult}"/>
                            </dxlc:LayoutItem>
                            <dxlc:LayoutItem Label="IsSimpleProject">
                                <dxe:CheckEdit EditValue="{Binding CurrentProject.IsSimpleProject}" />
                            </dxlc:LayoutItem>
                            <Button Content="Add project" Command="{Binding AddNewProjectCommand}" Height="20"/>
                            <Button Content="Open acitons" Command="{Binding OpenEditProjectCommand}" Height="20"/>
                            <Button Content="SaveChanges"  Height="20" Command="{Binding SaveChangesCommand}"/>
                            <Button Content="test" Click="Button_Click"/>
                        </dxlc:LayoutGroup>
                        <dxlc:LayoutGroup Orientation="Vertical" x:Name="ActionGroup" IsEnabled="{Binding SelectedProject,Converter={StaticResource objToBoolConverter}}">
                            <dxmvvm:Interaction.Behaviors>
                                <dxmvvm:EventToCommand EventName="PreviewKeyDown" Command="{Binding PreviewKeyActionsCommand}" PassEventArgsToCommand="True"/>
                            </dxmvvm:Interaction.Behaviors>
                            <dxlc:LayoutItem Label="Name:">
                                <dxe:TextEdit EditValue="{Binding CurrentAction.Name,UpdateSourceTrigger=PropertyChanged}"/>
                            </dxlc:LayoutItem>
                            <dxlc:LayoutItem Label="Trigger:">
                                <dxe:ComboBoxEdit EditValue="{Binding CurrentAction.TriggerId}" ItemsSource="{Binding ActionTriggers}" ValueMember="Id" DisplayMember="Name">
                                    <dxe:ComboBoxEdit.Buttons>
                                        <dxe:ButtonInfo Content="+" Command="{Binding OpenNewInfoCommand}" CommandParameter="Trigger"/>
                                    </dxe:ComboBoxEdit.Buttons>
                                </dxe:ComboBoxEdit>
                            </dxlc:LayoutItem>
                            <dxlc:LayoutItem Label="Status:">
                                <dxe:ComboBoxEdit EditValue="{Binding CurrentAction.StatusId}" ItemsSource="{Binding ActionStatuses}" ValueMember="Id" DisplayMember="Name"/>
                            </dxlc:LayoutItem>
                            <dxlc:LayoutItem Label="ScheduledTime:">
                                <dxe:DateEdit EditValue="{Binding CurrentAction.ScheduledTime}"/>
                            </dxlc:LayoutItem>
                            <dxlc:LayoutItem Label="DelegatedTo:">
                                <dxe:ComboBoxEdit EditValue="{Binding CurrentAction.DelegatedTo}" ItemsSource="{Binding DelegatePersons}" ValueMember="Id" DisplayMember="Name" />
                            </dxlc:LayoutItem>
                            <dxlc:LayoutItem Label="IsActive:">
                                <dxe:CheckEdit EditValue="{Binding CurrentAction.IsActive}"/>
                            </dxlc:LayoutItem>
                            <dxlc:LayoutItem Label="Comment:">
                                <dxe:MemoEdit EditValue="{Binding CurrentAction.Comment}" />
                            </dxlc:LayoutItem>
                            <Button Content="{Binding SelectedProject.Name,StringFormat=Now {0}}" Command="{Binding AddActionCommand}"/>
                        </dxlc:LayoutGroup>
                    </dxlc:LayoutGroup>
                    <local:ProjectsView/>
                </dxlc:LayoutGroup>
            </dx:DXTabItem>
            <dx:DXTabItem Header="AllProjects">
                <local:ProjectsView/>
            </dx:DXTabItem>
            <dx:DXTabItem Header="Waited">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="23"/>
                        <RowDefinition Height="23"/>
                        <RowDefinition/>
                    </Grid.RowDefinitions>
                    <Button Content="Get Data" Command="{Binding ProvideActiveActionsCommand}"/>
                    <Button Content="Export" Command="{Binding ExportWaitedGridCommand}" Grid.Row="1"/>
                    <dxg:GridControl Grid.Row="2" Tag="WaitedActionsGrid" Name="WaitedActionsGrid"
                                     ItemsSource="{Binding ActiveActions}" AutoExpandAllGroups="True"
                                     >
                        <dxmvvm:Interaction.Behaviors>
                            <dxmvvm:EventToCommand EventName="CustomRowFilter" PassEventArgsToCommand="True" Command="{Binding CustomRowFilterCommand}"/>
                            <local:ExportToExcelService ExportTable="{Binding Path=View,ElementName=WaitedActionsGrid}"/>
                        </dxmvvm:Interaction.Behaviors>
                        <dxg:GridControl.Columns>
                            <dxg:GridColumn FieldName="Name" Width="550"/>
                            <dxg:GridColumn FieldName="TriggerId" GroupIndex="0" >
                                <dxg:GridColumn.EditSettings>
                                    <dxe:ComboBoxEditSettings ItemsSource="{Binding ActionTriggers}" ValueMember="Id" DisplayMember="Name" >
                                        <dxe:ComboBoxEditSettings.Buttons>
                                            <dxe:ButtonInfo Content="+" Command="{Binding OpenNewInfoCommand}" CommandParameter="Trigger"/>
                                        </dxe:ComboBoxEditSettings.Buttons>
                                    </dxe:ComboBoxEditSettings>
                                </dxg:GridColumn.EditSettings>
                                <dxg:GridColumn.GroupValueTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding DisplayText,Converter={local:CustomDisplayTextConverter}}" />
                                    </DataTemplate>
                                </dxg:GridColumn.GroupValueTemplate>
                            </dxg:GridColumn>
                            <dxg:GridColumn FieldName="DateCreated" ReadOnly="True"/>
                            <dxg:GridColumn FieldName="Comment">
                                <dxg:GridColumn.EditSettings>
                                    <dxe:MemoEditSettings />
                                </dxg:GridColumn.EditSettings>
                            </dxg:GridColumn>
                            <dxg:GridColumn FieldName="TriggerId">
                                <dxg:GridColumn.EditSettings>
                                    <dxe:ComboBoxEditSettings ItemsSource="{Binding ActionTriggers}" ValueMember="Id" DisplayMember="Name"/>
                                </dxg:GridColumn.EditSettings>
                            </dxg:GridColumn>
                            <dxg:GridColumn FieldName="ProjectName" />
                            <dxg:GridColumn FieldName="ProjectType" GroupIndex="1">
                                <dxg:GridColumn.EditSettings>
                                    <dxe:ComboBoxEditSettings ItemsSource="{Binding ProjectTypes}" ValueMember="Id" DisplayMember="Name"/>
                                </dxg:GridColumn.EditSettings>
                            </dxg:GridColumn>
                            <dxg:GridColumn FieldName="StatusId">
                                <dxg:GridColumn.EditSettings>
                                    <dxe:ComboBoxEditSettings  ItemsSource="{Binding ActionStatuses}" ValueMember="Id" DisplayMember="Name"/>
                                </dxg:GridColumn.EditSettings>
                            </dxg:GridColumn>
                        </dxg:GridControl.Columns>
                    </dxg:GridControl>
                </Grid>
            </dx:DXTabItem>
            <dx:DXTabItem Header="Scheduled">
                <dxg:GridControl Grid.Row="1" Tag="ScheduledActionsGrid"
                                     ItemsSource="{Binding ActiveActions}"
                                  AutoExpandAllGroups="True"
                                     >
                    <dxmvvm:Interaction.Behaviors>
                        <dxmvvm:EventToCommand EventName="CustomRowFilter" PassEventArgsToCommand="True" Command="{Binding CustomRowFilterCommand}"/>
                    </dxmvvm:Interaction.Behaviors>
                    <dxg:GridControl.Columns>
                        <dxg:GridColumn FieldName="Name"/>

                        <dxg:GridColumn FieldName="DateCreated" ReadOnly="True"/>
                        <dxg:GridColumn FieldName="ScheduledTime" GroupIndex="0">
                            <dxg:GridColumn.EditSettings>
                                <dxe:DateEditSettings/>
                            </dxg:GridColumn.EditSettings>
                        </dxg:GridColumn>
                        <dxg:GridColumn FieldName="Comment">
                            <dxg:GridColumn.EditSettings>
                                <dxe:MemoEditSettings />
                            </dxg:GridColumn.EditSettings>
                        </dxg:GridColumn>
                        <dxg:GridColumn FieldName="ProjectName" />
                    </dxg:GridControl.Columns>
                </dxg:GridControl>
            </dx:DXTabItem>
            <dx:DXTabItem Header="Delegated">
                <dxg:GridControl Grid.Row="1" Tag="DelegatedActionsGrid"
                                     ItemsSource="{Binding ActiveActions}"
                                  AutoExpandAllGroups="True"
                                     >
                    <dxmvvm:Interaction.Behaviors>
                        <dxmvvm:EventToCommand EventName="CustomRowFilter" PassEventArgsToCommand="True" Command="{Binding CustomRowFilterCommand}"/>
                    </dxmvvm:Interaction.Behaviors>
                    <dxg:GridControl.Columns>
                        <dxg:GridColumn FieldName="Name"/>

                        <dxg:GridColumn FieldName="DateCreated" ReadOnly="True"/>
                        <dxg:GridColumn FieldName="DelegatedTo" GroupIndex="0">
                            <dxg:GridColumn.CellTemplate>
                                <DataTemplate>
                                    <dxe:ComboBoxEdit x:Name="PART_Editor" 
                                                                          ItemsSource="{Binding View.DataContext.DelegatePersons}" 
                                                                               ValueMember="Id" DisplayMember="Name" 
                                                                               >
                                        <dxe:ComboBoxEdit.Style>
                                            <Style TargetType="dxe:ComboBoxEdit">
                                                <Setter Property="IsEnabled" Value="False"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding RowData.Row.StatusId}" Value="3">
                                                        <Setter Property="IsEnabled" Value="True"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </dxe:ComboBoxEdit.Style>
                                    </dxe:ComboBoxEdit>
                                </DataTemplate>
                            </dxg:GridColumn.CellTemplate>
                            <dxg:GridColumn.EditSettings>
                                <dxe:ComboBoxEditSettings   ItemsSource="{Binding DelegatePersons}" 
                                                                               ValueMember="Id" DisplayMember="Name" />
                            </dxg:GridColumn.EditSettings>
                        </dxg:GridColumn>
                        <dxg:GridColumn FieldName="Comment">
                            <dxg:GridColumn.EditSettings>
                                <dxe:MemoEditSettings />
                            </dxg:GridColumn.EditSettings>
                        </dxg:GridColumn>
                        <dxg:GridColumn FieldName="ProjectName" />
                    </dxg:GridControl.Columns>
                </dxg:GridControl>
            </dx:DXTabItem>
        </dx:DXTabControl>
    </Grid>
</dx:DXWindow>
